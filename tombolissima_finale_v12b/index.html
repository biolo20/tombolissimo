<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <title>TOMBOLISSIMA - Tombola di Natale e Tradizionale</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --bg-main: #020617;
      --accent-gold: #facc15;
      --accent-gold-soft: #fde68a;
      --accent-red: #b91c1c;
      --accent-green: #15803d;
      --accent-blue-soft: #bfdbfe;
      --accent-blue-strong: #3b82f6;
      --text-main: #e5e7eb;
      --text-soft: #9ca3af;
      --border-soft: #1f2937;
      --radius-lg: 26px;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      background:
        radial-gradient(circle at top left, rgba(185, 28, 28, 0.22), transparent 55%),
        radial-gradient(circle at bottom right, rgba(22, 101, 52, 0.22), transparent 55%),
        radial-gradient(circle at top, #020617 0%, #020617 45%, #020617 100%);
      color: var(--text-main);
      padding: 20px;
    }

    /* VISTE */
    .view { display: none; width: 100%; }
    .view.active { display: block; }

    /* HOME ---------------------------------------------------- */
    .home {
      max-width: 820px;
      margin: 0 auto;
      background:
        radial-gradient(circle at top, rgba(15, 23, 42, 0.95), #020617 75%);
      border-radius: var(--radius-lg);
      padding: 24px 26px 26px;
      box-shadow:
        0 0 0 1px rgba(15, 23, 42, 0.9),
        0 24px 80px rgba(0, 0, 0, 0.85);
      position: relative;
      overflow: hidden;
    }

    .home::before {
      content: "";
      position: absolute;
      inset: 10px;
      border-radius: 20px;
      border: 1px solid rgba(15, 23, 42, 0.9);
      pointer-events: none;
    }

    .home-deco-left {
      position: absolute;
      width: 180px;
      height: 180px;
      border-radius: 999px;
      filter: blur(18px);
      opacity: 0.4;
      pointer-events: none;
      z-index: 0;
      top: -60px;
      left: -40px;
      background: radial-gradient(circle, rgba(220, 38, 38, 0.8), transparent 60%);
    }

    /* Alberi di Natale in HOME */
    .home-tree{
      position:absolute;
      z-index: 3; /* visibili sopra le card */
      font-size: 5.6rem;
      opacity: 1;
      pointer-events:none;
      user-select:none;
      filter: drop-shadow(0 14px 22px rgba(0,0,0,0.55));
    }
    .home-tree-left{ left: -8px; top: -8px; transform: rotate(-10deg); }
    .home-tree-right{ right: -8px; top: -8px; transform: rotate(10deg); }

    .home-inner { position: relative; z-index: 2; }

    .home-header { text-align: center; margin-bottom: 20px; }
    .home-title-row { display:flex; justify-content:center; align-items:center; gap:10px; margin-bottom:4px; }
    .home-title-icon { font-size: 1.6rem; }
    .home-title {
      font-size: 2.3rem;
      font-weight: 900;
      letter-spacing: 0.28em;
      text-transform: uppercase;
      color: #fefce8;
      text-shadow:
        0 0 12px rgba(252, 211, 77, 0.65),
        0 0 26px rgba(234, 179, 8, 0.8);
    }
    .home-sub {
      font-size: 0.9rem;
      letter-spacing: 0.14em;
      text-transform: uppercase;
      color: var(--text-soft);
      margin-top: 4px;
    }
    .home-underline {
      margin: 10px auto 0;
      width: 210px;
      height: 3px;
      border-radius: 999px;
      background: linear-gradient(90deg, var(--accent-red), var(--accent-gold), var(--accent-green));
      box-shadow: 0 0 16px rgba(250, 204, 21, 0.6);
    }

    .home-grid {
      display:grid;
      grid-template-columns: minmax(0, 1.05fr) minmax(0, 0.95fr);
      gap: 18px;
      margin-top: 22px;
    }

    .home-card {
      position: relative;
      border-radius: 20px;
      padding: 16px 16px 18px;
      border: 1px solid rgba(31, 41, 55, 0.9);
      box-shadow:
        0 0 18px rgba(15, 23, 42, 1),
        inset 0 0 22px rgba(15, 23, 42, 1);
      cursor: pointer;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      min-height: 150px;
      transition:
        transform 0.18s ease,
        box-shadow 0.18s ease,
        border-color 0.18s ease,
        background 0.18s ease;
    }

    .home-card-classic {
      background:
        radial-gradient(circle at top left, rgba(59, 130, 246, 0.18), transparent 60%),
        radial-gradient(circle at bottom right, rgba(15, 23, 42, 0.95), #020617 80%);
    }

    .home-card-xmas {
      background:
        radial-gradient(circle at top left, rgba(220, 38, 38, 0.18), transparent 60%),
        radial-gradient(circle at bottom right, rgba(22, 163, 74, 0.18), transparent 60%),
        radial-gradient(circle at center, rgba(15, 23, 42, 0.95), #020617 80%);
    }

    .home-card:hover {
      transform: translateY(-3px);
      border-color: rgba(250, 204, 21, 0.9);
      box-shadow:
        0 18px 40px rgba(0, 0, 0, 0.9),
        0 0 24px rgba(250, 204, 21, 0.75);
    }

    .home-card-badge {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: var(--text-soft);
      margin-bottom: 6px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }
    .home-card-badge-dot {
      width: 8px; height: 8px; border-radius: 999px; background: var(--accent-blue-strong);
    }
    .home-card-badge-dot-xmas { background: var(--accent-red); }

    .home-card-title { font-size: 1.15rem; font-weight: 700; margin-bottom: 4px; }
    .home-card-title span.icon { margin-right: 6px; }

    .home-card-desc { font-size: 0.85rem; color: var(--text-soft); }

    .home-card-footer {
      margin-top: 12px;
      display:flex;
      align-items:center;
      justify-content: space-between;
      font-size: 0.8rem;
      color: var(--text-soft);
    }

    .home-card-footer-tag {
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      background: rgba(15, 23, 42, 0.9);
    }

    .home-card-button {
      border-radius: 999px;
      padding: 8px 16px;
      border: none;
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
      background: linear-gradient(135deg, var(--accent-red), var(--accent-gold));
      color: #111827;
      box-shadow:
        0 6px 18px rgba(185, 28, 28, 0.6),
        0 0 18px rgba(250, 204, 21, 0.6);
      transition: transform 0.14s ease, box-shadow 0.14s ease, filter 0.14s ease;
    }
    .home-card-button:hover {
      transform: translateY(-1px);
      filter: brightness(1.05);
      box-shadow:
        0 10px 26px rgba(185, 28, 28, 0.7),
        0 0 24px rgba(250, 204, 21, 0.7);
    }

    .home-footer {
      margin-top: 20px;
      text-align: center;
      font-size: 0.75rem;
      color: var(--text-soft);
    }

    /* PULSANTE TORNA ALLA HOME */
    .back-home {
      position: absolute;
      top: 14px;
      left: 16px;
      z-index: 10;
      padding: 6px 14px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      background: rgba(15, 23, 42, 0.95);
      color: var(--text-soft);
      font-size: 0.8rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: background 0.15s ease, box-shadow 0.15s ease, transform 0.15s ease;
    }
    .back-home span.icon { font-size: 0.9rem; }
    .back-home:hover {
      background: #020617;
      box-shadow: 0 0 14px rgba(15, 23, 42, 0.7);
      transform: translateY(-1px);
    }

    /* FULLSCREEN (proiettore) */
    .fullscreen-btn{
      position:absolute;
      top: 14px;
      right: 16px;
      z-index: 10;
      padding: 6px 14px;
      border-radius: 999px;
      border: 1px solid rgba(250, 204, 21, 0.85);
      background: rgba(15, 23, 42, 0.95);
      color: #fefce8;
      font-size: 0.8rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      gap:8px;
      box-shadow: 0 0 18px rgba(250, 204, 21, 0.18);
      transition: transform 0.15s ease, box-shadow 0.15s ease, filter 0.15s ease;
      user-select:none;
    }
    .fullscreen-btn:hover{
      transform: translateY(-1px);
      filter: brightness(1.05);
      box-shadow: 0 0 22px rgba(250, 204, 21, 0.25);
    }
    .fullscreen-btn .fs-ico{ font-size: 1rem; }

    /* PROIETTORE: quando fullscreen aumenta leggibilit√† */
    .projector-mode .xmas-current-number{ font-size: 3.6rem; }
    .projector-mode .xmas-cell{ font-size: 1.05rem; }
    .projector-mode .xmas-title-main{ font-size: 2.6rem; }
    .projector-mode .xmas-board{ gap: 8px; }
    .projector-mode .xmas-board-wrapper,
    .projector-mode .xmas-panel{ box-shadow: 0 0 26px rgba(0,0,0,0.9), inset 0 0 26px rgba(15,23,42,1); }

    /* TOMBOLA CLASSICA ---------------------------------------- */
    .app-classic, .app-xmas{
      position: relative;
      display: flex;
      flex-direction: column;
      gap: 16px;
      background: radial-gradient(circle at top, rgba(15, 23, 42, 0.95), #020617 75%);
      border-radius: var(--radius-lg);
      padding: 20px 22px 24px;
      max-width: 1180px;
      width: 100%;
      box-shadow:
        0 0 0 1px rgba(15, 23, 42, 0.9),
        0 24px 80px rgba(0, 0, 0, 0.85);
      overflow: hidden;
      margin: 0 auto;
    }
    .app-classic::before, .app-xmas::before{
      content:"";
      position:absolute;
      inset:10px;
      border-radius:20px;
      border: 1px solid rgba(15, 23, 42, 0.9);
      pointer-events:none;
    }

    .classic-header, .xmas-header{
      text-align:center;
      padding-bottom: 8px;
      border-bottom: 1px solid rgba(15, 23, 42, 0.9);
    }
    .classic-title{
      font-size: 2.1rem;
      font-weight: 900;
      letter-spacing: 0.26em;
      text-transform: uppercase;
      color:#e5e7eb;
    }
    .classic-sub{ font-size:0.85rem; letter-spacing:0.16em; text-transform:uppercase; color:var(--text-soft); margin-top:4px; }

    .classic-body, .xmas-body{ display:flex; gap:24px; margin-top:6px; }

    .classic-board-wrapper, .xmas-board-wrapper{
      flex:1.4;
      background: radial-gradient(circle at top, rgba(15, 23, 42, 0.9), #020617 80%);
      border-radius: 22px;
      padding: 18px 18px 20px;
      border: 1px solid rgba(31, 41, 55, 0.9);
      box-shadow: 0 0 22px rgba(15, 23, 42, 1), inset 0 0 28px rgba(15, 23, 42, 1);
    }
    .classic-board-title, .xmas-board-title{
      text-align:center;
      margin-bottom:10px;
      font-size:0.95rem;
      letter-spacing:0.16em;
      text-transform:uppercase;
      color:var(--text-main);
    }
    .classic-board, .xmas-board{
      display:grid;
      grid-template-columns: repeat(10, minmax(30px, 1fr));
      gap: 6px;
    }

    .classic-cell, .xmas-cell{
      aspect-ratio: 1 / 1;
      border-radius: 12px;
      border: 1px solid var(--border-soft);
      display:flex;
      align-items:center;
      justify-content:center;
      background: radial-gradient(circle at top, #020617 0%, #020617 60%);
      color:#e5e7eb;
      box-shadow: inset 0 0 10px rgba(15, 23, 42, 1);
      transition: transform 0.18s ease, box-shadow 0.18s ease, background 0.18s ease, color 0.18s ease, border-color 0.18s ease, filter 0.18s ease;
      font-size: 0.9rem;
    }
    .classic-cell{ border-radius: 10px; font-size: 0.85rem; }
    .classic-cell:hover, .xmas-cell:hover{ transform: translateY(-1px); filter: brightness(1.06); border-color: rgba(148, 163, 184, 0.7); }
    .classic-cell.extracted{
      background: linear-gradient(135deg, #eff6ff, #bfdbfe);
      color: #0f172a;
      font-weight: 700;
      border-color: #e0f2fe;
      box-shadow: 0 0 10px rgba(191, 219, 254, 0.7);
    }

    @keyframes cellPop { 0% { transform: scale(0.9); opacity: 0;} 60%{transform:scale(1.04); opacity:1;} 100%{transform:scale(1.0);} }
    .xmas-cell.extracted{
      background: linear-gradient(135deg, #fef3c7, var(--accent-gold-soft));
      color: #111827;
      font-weight: 700;
      border-color: #fbbf24;
      box-shadow: 0 0 8px rgba(251, 191, 36, 0.6);
      transform: scale(1.0);
      animation: cellPop 0.18s ease-out;
    }

    .classic-controls, .xmas-controls{ flex:0.9; display:flex; flex-direction:column; gap:16px; }
    .classic-panel, .xmas-panel{
      background: radial-gradient(circle at top, rgba(15, 23, 42, 0.9), #020617 80%);
      border-radius: 22px;
      padding: 18px 18px 20px;
      border: 1px solid rgba(31, 41, 55, 0.9);
      box-shadow: 0 0 22px rgba(15, 23, 42, 1), inset 0 0 26px rgba(15, 23, 42, 1);
    }
    .classic-panel h2, .xmas-panel h2{
      font-size: 0.9rem;
      margin-bottom: 10px;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: var(--text-soft);
    }

    .classic-current-number-container, .xmas-current-number-container{ display:flex; flex-direction:column; align-items:center; gap:16px; }

    .classic-current-number{
      width: 110px; height:110px; border-radius:999px; border:3px solid rgba(148,163,184,0.6);
      display:flex; align-items:center; justify-content:center;
      font-size: 2.8rem; font-weight:800;
      background: radial-gradient(circle at top, #020617, #020617 65%);
      color:#f9fafb;
      text-shadow: 0 0 8px rgba(15,23,42,1), 0 0 24px rgba(15,23,42,0.8);
    }

    .xmas-spinner-wrapper{ position:relative; width:130px; height:130px; }
    .xmas-spinner-ring{
      position:absolute; inset:0; border-radius:999px; border:7px solid #020617;
      border-top-color:#ffffff; border-right-color:#b91c1c; border-bottom-color:#ffffff; border-left-color:#b91c1c;
      box-shadow: 0 0 14px rgba(248,250,252,0.22), 0 0 20px rgba(248,250,252,0.35);
    }
    @keyframes spin{ from{transform:rotate(0deg);} to{transform:rotate(360deg);} }
    .xmas-spinner-ring.animate{ animation: spin 0.65s linear infinite; }

    .xmas-current-number{
      position:absolute; inset:14px; border-radius:999px;
      background: radial-gradient(circle at top, #020617 0%, #020617 60%, #020617 100%);
      display:flex; align-items:center; justify-content:center;
      font-size: 3.1rem; font-weight:900; letter-spacing:0.06em;
      color:#f9fafb;
      text-shadow: 0 0 12px rgba(15, 23, 42, 1), 0 0 30px rgba(15, 23, 42, 0.9);
    }

    .classic-status, .xmas-status-text{ font-size:0.9rem; color:var(--text-main); text-align:center; min-height: 1.4em; }

    .classic-button-wrapper, .xmas-button-wrapper{ display:flex; flex-direction:column; gap:8px; margin-top:6px; width:100%; }
    .classic-button, .xmas-button{
      border-radius:999px; padding:12px 20px; border:none; font-size:1rem; font-weight:600; cursor:pointer;
      box-shadow: 0 8px 22px rgba(15, 23, 42, 0.6);
      transition: transform 0.14s ease, box-shadow 0.14s ease, filter 0.14s ease, opacity 0.14s ease;
    }
    .classic-button{
      background: linear-gradient(135deg, #3b82f6, #93c5fd);
      color:#02131f;
      box-shadow: 0 8px 22px rgba(15, 23, 42, 0.6), 0 0 18px rgba(147, 197, 253, 0.6);
    }
    .xmas-button{
      background: linear-gradient(135deg, var(--accent-red), var(--accent-gold));
      color:#111827;
      box-shadow: 0 8px 22px rgba(185, 28, 28, 0.6), 0 0 22px rgba(250, 204, 21, 0.6);
      position:relative; overflow:hidden;
    }
    .classic-button:hover:not(:disabled), .xmas-button:hover:not(:disabled){
      transform: translateY(-1px) scale(1.03);
      filter: brightness(1.05);
    }
    .classic-button:disabled, .xmas-button:disabled{ opacity:0.55; cursor:not-allowed; box-shadow:none; }

    .classic-secondary-button, .xmas-secondary-button{
      background:#020617; color:var(--text-main);
      border-radius:999px; border:1px dashed rgba(148,163,184,0.6);
      padding:8px 14px; font-size:0.8rem; text-transform:uppercase; letter-spacing:0.12em;
      cursor:pointer;
      box-shadow:none;
    }
    .classic-secondary-button:hover, .xmas-secondary-button:hover{ box-shadow: 0 0 12px rgba(148,163,184,0.35); }

    .classic-stats, .xmas-stats{
      display:flex; justify-content:space-between;
      font-size:0.85rem; color:var(--text-main);
      margin-top:10px; width:100%;
    }
    .xmas-stats span strong{ color: var(--accent-gold); }

    .classic-info, .xmas-info{ font-size:0.8rem; color:var(--text-soft); margin-top:8px; text-align:center; }

    /* Storico */
    .classic-history, .xmas-history{ margin-top:14px; width:100%; }
    .classic-history-title, .xmas-history-title{
      font-size:0.8rem; text-transform:uppercase; letter-spacing:0.14em; color:var(--text-soft); margin-bottom:6px; text-align:left;
    }
    .classic-history-list, .xmas-history-list{ display:flex; justify-content:space-between; gap:6px; width:100%; }
    .classic-history-item, .xmas-history-item{
      flex:1; border-radius:999px; border:1px solid rgba(148,163,184,0.5);
      padding:6px 0; font-size:0.9rem; text-align:center;
      background: radial-gradient(circle at top, #020617, #020617 60%);
      color:#f9fafb;
      box-shadow: inset 0 0 10px rgba(15, 23, 42, 1);
      transition: opacity 0.25s ease;
    }
    .classic-history-item.newest{
      background: linear-gradient(135deg, #bfdbfe, #60a5fa);
      border-color:#e0f2fe;
      color:#02131f;
      box-shadow: 0 0 12px rgba(96, 165, 250, 0.7);
    }
    .xmas-history-item.newest{
      background: linear-gradient(135deg, #b91c1c, #f97316);
      border-color:#fecaca;
      box-shadow: 0 0 12px rgba(248, 113, 113, 0.7);
    }

    /* XMAS header */
    .xmas-title-row{ display:flex; justify-content:center; align-items:center; gap:10px; margin-bottom:4px; }
    .xmas-title-icon{ font-size:1.6rem; }
    .xmas-title-main{
      font-size: 2.3rem;
      font-weight: 900;
      letter-spacing: 0.28em;
      text-transform: uppercase;
      color: #fefce8;
      text-shadow: 0 0 12px rgba(252, 211, 77, 0.65), 0 0 26px rgba(234, 179, 8, 0.8);
    }
    /* SOTTOTITOLO RIMOSSO */
    .xmas-title-sub{ display:none !important; }
    .xmas-title-underline{
      margin: 10px auto 0;
      width: 180px;
      height: 3px;
      border-radius: 999px;
      background: linear-gradient(90deg, var(--accent-red), var(--accent-gold), var(--accent-green));
      box-shadow: 0 0 16px rgba(250, 204, 21, 0.55);
    }

    /* Banner finale */
    .app-xmas .finished-banner{
      position:absolute; inset:0; display:none; align-items:center; justify-content:center; text-align:center;
      background: radial-gradient(circle at center, rgba(15, 23, 42, 0.96), rgba(15, 23, 42, 0.98));
      backdrop-filter: blur(4px);
      z-index: 5;
    }
    .app-xmas .finished-banner-inner{
      padding: 18px 26px;
      border-radius: 999px;
      border: 1px solid rgba(250, 204, 21, 0.8);
      background: linear-gradient(135deg, rgba(248, 250, 252, 0.04), rgba(15, 23, 42, 0.95));
      box-shadow: 0 0 28px rgba(250, 204, 21, 0.55), 0 0 46px rgba(34, 197, 94, 0.4);
      color: #fefce8;
      font-size: 1.1rem;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      display:flex; align-items:center; gap:10px;
    }
    @keyframes fadeSlide{ from{opacity:0; transform: translateY(10px);} to{opacity:1; transform: translateY(0);} }
    .app-xmas .finished-banner.show{ display:flex; animation: fadeSlide 0.6s ease-out; }

    /* BOX 9 QUADRATI (XMAS) */
    .xmas-feature-box{
      margin-top:14px; width:100%;
      border-radius:14px;
      border:1px solid rgba(148, 163, 184, 0.5);
      padding:10px 10px 12px;
      background: radial-gradient(circle at top, rgba(15, 23, 42, 0.95), #020617 80%);
    }
    .xmas-feature-title{
      font-size:0.8rem; text-transform:uppercase; letter-spacing:0.13em;
      color: var(--text-soft); margin-bottom:8px;
    }
    .xmas-feature-grid{ display:grid; grid-template-columns: repeat(3, minmax(0, 1fr)); gap: 8px; }
    .xmas-feature-cell{
      border-radius: 12px;
      border:1px solid rgba(148, 163, 184, 0.6);
      padding: 10px 0 12px;
      background: radial-gradient(circle at top, rgba(15, 23, 42, 1), #020617 75%);
      color:#e5e7eb;
      font-size:0.8rem;
      text-align:center;
      cursor:pointer;
      box-shadow: inset 0 0 12px rgba(15, 23, 42, 1);
      transition: transform 0.16s ease, box-shadow 0.16s ease, border-color 0.16s ease, filter 0.16s ease;
      display:flex; flex-direction:column; gap:2px; align-items:center; justify-content:center;
    }
    .xmas-feature-cell-number{ font-size:1.4rem; font-weight:700; color:#fefce8; letter-spacing:0.05em; }
    .xmas-feature-cell:hover{
      transform: translateY(-1px) scale(1.03);
      border-color: rgba(250, 204, 21, 0.9);
      box-shadow: 0 0 18px rgba(250, 204, 21, 0.6), 0 0 24px rgba(34, 197, 94, 0.4);
      filter: brightness(1.07);
    }
    .xmas-feature-cell.used{
      border-color: rgba(34, 197, 94, 0.85);
      background: radial-gradient(circle at top, rgba(22, 163, 74, 0.8), #022c22 80%);
      box-shadow: 0 0 18px rgba(34, 197, 94, 0.7);
    }

    /* MODAL POPUP */
    .modal{ position:fixed; inset:0; display:none; align-items:center; justify-content:center; z-index:20; }
    .modal.show{ display:flex; }
    .modal-backdrop{ position:absolute; inset:0; background: rgba(15, 23, 42, 0.8); backdrop-filter: blur(4px); }
    .modal-content{
      position:relative; z-index:1;
      max-width: 110vh;
      width: 92%;
      background: radial-gradient(circle at top, rgba(15, 23, 42, 0.98), #020617 90%);
      border-radius: 18px;
      padding: 18px 18px 20px;
      border: 1px solid rgba(250, 204, 21, 0.8);
      box-shadow: 0 0 24px rgba(250, 204, 21, 0.6), 0 0 36px rgba(34, 197, 94, 0.4);
      color: #fefce8;
      transform-origin:center;
    }
    @keyframes modalFlipIn{
      0%{ transform: perspective(600px) rotateY(-18deg) scale(0.9); opacity:0; }
      60%{ transform: perspective(600px) rotateY(4deg) scale(1.03); opacity:1; }
      100%{ transform: perspective(600px) rotateY(0deg) scale(1); opacity:1; }
    }
    .modal-header{ display:flex; justify-content:space-between; align-items:center; margin-bottom:10px; }
    .modal-title{ font-size:0.9rem; text-transform:uppercase; letter-spacing:0.14em; }
    .modal-close{
      border:none; border-radius:999px; width:28px; height:28px;
      display:flex; align-items:center; justify-content:center;
      cursor:pointer; background: rgba(15, 23, 42, 0.9);
      color:#f9fafb; font-size:1rem;
    }
    .modal-body{ font-size:0.9rem; color:#e5e7eb; }
    .modal-icon{ font-size:2.3rem; margin-bottom:8px; text-align:center; }
    .modal-activity-title{ font-size:1rem; font-weight:600; margin-bottom:6px; text-align:center; }
    .modal-activity-text{ font-size:0.9rem; color:#e5e7eb; line-height:1.4; white-space: pre-wrap; }

    /* SLIDER immagini */
    .modal-slider{ margin-top: 12px; display:none; }
    .modal-slider-frame{
      position:relative;
      border-radius: 16px;
      overflow:hidden;
      border:1px solid rgba(148, 163, 184, 0.55);
      background: rgba(2, 6, 23, 0.6);
      box-shadow: inset 0 0 12px rgba(15, 23, 42, 0.9);
    }
    .modal-slider-img{
      width:100%;
      height:auto;
      max-height: 420px;
      display:block;
      object-fit: contain;
    }
    .modal-slider-controls{
      display:flex; align-items:center; justify-content:space-between; gap:10px; margin-top:10px;
    }
    .modal-slider-btn{
      border:1px solid rgba(148, 163, 184, 0.6);
      background: rgba(15, 23, 42, 0.9);
      color:#f9fafb;
      border-radius:999px;
      padding: 8px 12px;
      font-size: 0.85rem;
      cursor:pointer;
      min-width: 44px;
      transition: transform 0.12s ease, box-shadow 0.12s ease, filter 0.12s ease;
    }
    .modal-slider-btn:hover{
      transform: translateY(-1px);
      box-shadow: 0 0 14px rgba(250, 204, 21, 0.25);
      filter: brightness(1.05);
    }
    .modal-slider-counter{
      font-size:0.75rem;
      letter-spacing:0.12em;
      text-transform:uppercase;
      color: var(--text-soft);
      text-align:center;
      flex:1;
    }


    /* Alberi di Natale nello sfondo (Tombola Natalizia) */
    .xmas-bg-tree{
      position:absolute;
      z-index:0;
      font-size: 9rem;
      opacity: 0.10;
      pointer-events:none;
      user-select:none;
      filter: blur(0.2px) drop-shadow(0 18px 24px rgba(0,0,0,0.55));
    }
    .xmas-bg-tree-left{ left: 10px; bottom: 10px; transform: rotate(-8deg); }
    .xmas-bg-tree-right{ right: 10px; bottom: 10px; transform: rotate(8deg); }

    /* Confetti (estrazione numero) */
    .confetti-layer{
      position: fixed;
      inset: 0;
      overflow: hidden;
      pointer-events: none;
      z-index: 999;
    }
    .confetto{
      position: absolute;
      width: 10px;
      height: 14px;
      border-radius: 3px;
      opacity: 0.95;
      animation: confetti-fall 650ms ease-out forwards;
      will-change: transform, opacity;
    }
    @keyframes confetti-fall{
      0%   { transform: translate3d(0,0,0) rotate(0deg); opacity: 0; }
      10%  { opacity: 1; }
      100% { transform: translate3d(var(--dx,0px), var(--dy,160px), 0) rotate(520deg); opacity: 0; }
    }
      10%  { opacity: 1; }
      100% { transform: translate3d(var(--x,0px), 110vh, 0) rotate(520deg); opacity: 0; }
    }


    /* RESPONSIVE */
    @media (max-width: 1000px) {
      .home-title, .xmas-title-main, .classic-title { font-size: 2rem; letter-spacing: 0.24em; }
      .home-grid { grid-template-columns: 1fr 1fr; }
    }
    @media (max-width: 900px) {
      .home { padding: 20px 18px 22px; }
      .home-grid { grid-template-columns: 1fr; }
      .app-classic, .app-xmas { padding: 18px 16px 22px; }
      .classic-body, .xmas-body { flex-direction: column; }
      .classic-controls, .xmas-controls { flex-direction: row; align-items: stretch; }
      .classic-panel, .xmas-panel { flex: 1; }
      .home-tree{ font-size: 3.6rem; }
    }
    @media (max-width: 700px) {
      .classic-controls, .xmas-controls { flex-direction: column; }
      .classic-board, .xmas-board { grid-template-columns: repeat(9, minmax(26px, 1fr)); }
      .home-title, .xmas-title-main, .classic-title { font-size: 1.7rem; letter-spacing: 0.20em; }
      .home-tree{ display:none; } /* su mobile nascondo gli alberi per non occupare spazio */
    }
  </style>
</head>
<body>
  <!-- HOME -------------------------------------------------------- -->
  <div id="view-home" class="view active">
    <div class="home">
      <div class="home-deco-left"></div>
      <!-- palla (deco-right) rimossa -->
      <div class="home-tree home-tree-left">üéÑ</div>
      <div class="home-tree home-tree-right">üéÑ</div>

      <div class="home-inner">
        <div class="home-header">
          <div class="home-title-row">
            <span class="home-title-icon">üé≤</span>
            <div class="home-title">TOMBOLISSIMA</div>
            <span class="home-title-icon">üé≤</span>
          </div>
          <div class="home-sub">seleziona la modalit√† di gioco</div>
          <div class="home-underline"></div>
        </div>

        <div class="home-grid">
          <!-- Card classica -->
          <div class="home-card home-card-classic" onclick="startClassic()">
            <div>
              <div class="home-card-badge">
                <span class="home-card-badge-dot"></span>
                <span>Modalit√† 1</span>
              </div>
              <div class="home-card-title">
                <span class="icon">üéØ</span>
                Tombola tradizionale
              </div>
              <div class="home-card-desc">
                Tabellone classico 1‚Äì90, grafica pulita e caselle azzurre. Ideale per serate semplici e ordinate.
              </div>
            </div>
            <div class="home-card-footer">
              <span class="home-card-footer-tag">Stile neutro</span>
              <button class="home-card-button" type="button">Avvia</button>
            </div>
          </div>

          <!-- Card natalizia -->
          <div class="home-card home-card-xmas" onclick="startXmas()">
            <div>
              <div class="home-card-badge">
                <span class="home-card-badge-dot home-card-badge-dot-xmas"></span>
                <span>Modalit√† 2</span>
              </div>
              <div class="home-card-title">
                <span class="icon">üéÑ</span>
                Tombola natalizia
              </div>
              <div class="home-card-desc">
                Tema rosso‚Äìverde‚Äìoro, animazione di estrazione, storico dei numeri e box speciale con giochi.
              </div>
            </div>
            <div class="home-card-footer">
              <span class="home-card-footer-tag">Perfetta per le feste</span>
              <button class="home-card-button" type="button">Avvia</button>
            </div>
          </div>
        </div>

        <div class="home-footer">
          Durante la partita puoi sempre tornare alla schermata iniziale con il pulsante ‚ÄúHome‚Äù.
        </div>
      </div>
    </div>
  </div>

  <!-- TOMBOLA CLASSICA -------------------------------------------- -->
  <div id="view-classic" class="view">
    <div class="app-classic">
      <button class="back-home" type="button" onclick="goHome()">
        <span class="icon">‚Üê</span>
        <span>Home</span>
      </button>

      <header class="classic-header">
        <div class="classic-title">TOMBOLA</div>
        <div class="classic-sub">modalit√† tradizionale</div>
      </header>

      <div class="classic-body">
        <div class="classic-board-wrapper">
          <div class="classic-board-title">Tabellone 1‚Äì90</div>
          <div id="classic-board" class="classic-board"></div>
        </div>

        <div class="classic-controls">
          <div class="classic-panel">
            <h2>Estrazione</h2>
            <div class="classic-current-number-container">
              <div id="classic-current-number" class="classic-current-number">‚Äì</div>
              <div id="classic-status" class="classic-status"></div>

              <div class="classic-button-wrapper">
                <button id="classic-draw-btn" class="classic-button" type="button">
                  Estrai
                </button>
                <button id="classic-reset-btn" class="classic-secondary-button" type="button">
                  Reimposta tabellone
                </button>
              </div>

              <div class="classic-stats">
                <span>Estratti: <strong id="classic-drawn-count">0</strong> / 90</span>
                <span>Rimasti: <strong id="classic-remaining-count">90</strong></span>
              </div>

              <div class="classic-history">
                <div class="classic-history-title">Ultimi numeri estratti</div>
                <div id="classic-history-list" class="classic-history-list"></div>
              </div>

              <p class="classic-info">
                Premi <strong>Estrai</strong> per pescare un nuovo numero.
                Il numero corrispondente verr√† marcato sul tabellone.
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- TOMBOLA NATALIZIA ------------------------------------------- -->
  <div id="view-xmas" class="view">
    <div class="app-xmas">
      <button class="back-home" type="button" onclick="goHome()">
        <span class="icon">‚Üê</span>
        <span>Home</span>
      </button>

      <div id="confetti-layer" class="confetti-layer"></div>

      <button id="fullscreen-btn" class="fullscreen-btn" type="button" title="Modalit√† proiettore (fullscreen)">
        <span class="fs-ico">‚õ∂</span>
        <span id="fs-label">Fullscreen</span>
      </button>

      <div id="xmas-finished-banner" class="finished-banner">
        <div class="finished-banner-inner">
          <span>üéâ</span>
          <span>Tutti i numeri sono stati estratti!</span>
          <span>üéâ</span>
        </div>
      </div>

      <header class="xmas-header">
        <div class="xmas-title-row">
          <span class="xmas-title-icon">üéÑ</span>
          <div class="xmas-title-main">TOMBOLISSIMA</div>
          <span class="xmas-title-icon">üéÑ</span>
        </div>
        <div class="xmas-title-sub">tombola natalizia proiettore</div>
        <div class="xmas-title-underline"></div>
      </header>

      <div class="xmas-body">
        <div class="xmas-board-wrapper">
          <div class="xmas-board-title">
            <span style="color: var(--accent-green);">Tombola</span> ‚Ä¢ Tabellone 1‚Äì90
          </div>
          <div id="xmas-board" class="xmas-board"></div>
        </div>

        <div class="xmas-controls">
          <div class="xmas-panel">
            <h2>Estrazione</h2>
            <div class="xmas-current-number-container">
              <div class="xmas-spinner-wrapper">
                <div id="xmas-spinner" class="xmas-spinner-ring"></div>
                <div id="xmas-current-number" class="xmas-current-number">‚Äì</div>
              </div>
              <div id="xmas-status" class="xmas-status-text"></div>

              <div class="xmas-button-wrapper">
                <button id="xmas-draw-btn" class="xmas-button" type="button">Estrai</button>
                <button id="xmas-reset-btn" class="xmas-secondary-button" type="button">
                  Reimposta tabellone
                </button>
              </div>

              <div class="xmas-stats">
                <span>Estratti: <strong id="xmas-drawn-count">0</strong> / 90</span>
                <span>Rimasti: <strong id="xmas-remaining-count">90</strong></span>
              </div>

              <div class="xmas-history">
                <div class="xmas-history-title">Ultimi numeri estratti</div>
                <div id="xmas-history-list" class="xmas-history-list"></div>
              </div>

              <div class="xmas-feature-box">
                <div class="xmas-feature-title">Giochi speciali</div>
                <div class="xmas-feature-grid">
                  <div class="xmas-feature-cell" data-slot="1"><div class="xmas-feature-cell-number">1</div></div>
                  <div class="xmas-feature-cell" data-slot="2"><div class="xmas-feature-cell-number">2</div></div>
                  <div class="xmas-feature-cell" data-slot="3"><div class="xmas-feature-cell-number">3</div></div>
                  <div class="xmas-feature-cell" data-slot="4"><div class="xmas-feature-cell-number">4</div></div>
                  <div class="xmas-feature-cell" data-slot="5"><div class="xmas-feature-cell-number">5</div></div>
                  <div class="xmas-feature-cell" data-slot="6"><div class="xmas-feature-cell-number">6</div></div>
                  <div class="xmas-feature-cell" data-slot="7"><div class="xmas-feature-cell-number">7</div></div>
                  <div class="xmas-feature-cell" data-slot="8"><div class="xmas-feature-cell-number">8</div></div>
                  <div class="xmas-feature-cell" data-slot="9"><div class="xmas-feature-cell-number">9</div></div>
                </div>
              </div>

              <p class="xmas-info">
                Premi <strong>Estrai</strong> per pescare un nuovo numero.
                La casella corrispondente nel tabellone si illuminer√† in automatico.
              </p>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>

  <!-- MODAL PER I 9 QUADRATI (XMAS) ------------------------------- -->
  <div id="feature-modal" class="modal">
    <div class="modal-backdrop" data-modal-close="true"></div>
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title">
          Gioco speciale <span id="modal-slot-label"></span>
        </div>
        <button class="modal-close" type="button" data-modal-close="true">√ó</button>
      </div>
      <div class="modal-body">
        <div id="modal-activity-icon" class="modal-icon"></div>
        <div id="modal-activity-title" class="modal-activity-title"></div>
        <div id="modal-activity-text" class="modal-activity-text"></div>
        <div id="modal-image-container" class="modal-slider"></div>
      </div>
    </div>
  </div>

  <script>
    /* GESTIONE VISTE ------------------------------------------------- */
    function showView(id) {
      document.querySelectorAll(".view").forEach(v => v.classList.remove("active"));
      const el = document.getElementById(id);
      if (el) el.classList.add("active");
    }
    function goHome(){ showView("view-home"); }
    function startClassic(){ showView("view-classic"); }
    function startXmas(){ showView("view-xmas"); }

    /* FULLSCREEN (XMAS) ---------------------------------------------- */
    (function initFullscreen(){
      const btn = document.getElementById("fullscreen-btn");
      const label = document.getElementById("fs-label");
      if (!btn) return;

      function update(){
        const isFs = !!document.fullscreenElement;
        btn.querySelector(".fs-ico").textContent = isFs ? "‚§¢" : "‚õ∂";
        if (label) label.textContent = isFs ? "Esci" : "Fullscreen";
        document.body.classList.toggle("projector-mode", isFs);
      }

      btn.addEventListener("click", function () {
        try {
          if (!document.fullscreenElement) {
            var p = document.documentElement.requestFullscreen();
            if (p && p.then) {
              p.then(update).catch(function (e) { console.warn("Fullscreen non disponibile:", e); update(); });
              return;
            }
          } else {
            var q = document.exitFullscreen();
            if (q && q.then) {
              q.then(update).catch(function (e) { console.warn("Fullscreen non disponibile:", e); update(); });
              return;
            }
          }
        } catch (e) {
          console.warn("Fullscreen non disponibile:", e);
        }
        update();
      });

      document.addEventListener("fullscreenchange", update);
      update();
    })();

    /* TOMBOLA CLASSICA ---------------------------------------------- */
    (function initClassic() {
      const boardEl = document.getElementById("classic-board");
      const drawBtn = document.getElementById("classic-draw-btn");
      const resetBtn = document.getElementById("classic-reset-btn");
      const currentNumberEl = document.getElementById("classic-current-number");
      const statusEl = document.getElementById("classic-status");
      const drawnCountEl = document.getElementById("classic-drawn-count");
      const remainingCountEl = document.getElementById("classic-remaining-count");
      const historyListEl = document.getElementById("classic-history-list");

      let remainingNumbers = [];
      let drawnNumbers = [];

      const confettiLayerEl = document.getElementById("confetti-layer");

      function launchConfetti() {
        const layer = document.getElementById("confetti-layer");
        if (!layer) return;

        layer.innerHTML = "";
        const colors = ["#facc15", "#b91c1c", "#15803d", "#fefce8", "#fde68a"];
        const pieces = 70;

        for (let i = 0; i < pieces; i++) {
          const d = document.createElement("div");
          d.className = "confetto";

          const left = Math.random() * 100;
          const x = (Math.random() - 0.5) * 420;       // deriva laterale pi√π ampia
          const delay = Math.random() * 220;
          const w = 6 + Math.random() * 10;
          const h = 8 + Math.random() * 16;

          d.style.left = left + "vw";
          d.style.setProperty("--x", x.toFixed(1) + "px");
          d.style.animationDelay = delay + "ms";
          d.style.width = w + "px";
          d.style.height = h + "px";
          d.style.background = colors[Math.floor(Math.random() * colors.length)];
          d.style.opacity = String(0.7 + Math.random() * 0.3);

          layer.appendChild(d);
        }

        // pulizia dopo la fine dell‚Äôanimazione
        setTimeout(() => { layer.innerHTML = ""; }, 1500);
      }
      function createBoard() {
        boardEl.innerHTML = "";
        for (let i = 1; i <= 90; i++) {
          const cell = document.createElement("div");
          cell.className = "classic-cell";
          cell.dataset.number = i;
          cell.textContent = i;
          boardEl.appendChild(cell);
        }
      }

      function updateStats() {
        drawnCountEl.textContent = drawnNumbers.length;
        remainingCountEl.textContent = remainingNumbers.length;
      }

      function updateHistory() {
        historyListEl.innerHTML = "";
        if (drawnNumbers.length === 0) return;
        const lastFive = drawnNumbers.slice(-5).reverse();
        const opacities = [1, 0.85, 0.7, 0.55, 0.4];

        lastFive.forEach((num, index) => {
          const item = document.createElement("div");
          item.className = "classic-history-item";
          if (index === 0) item.classList.add("newest");
          item.style.opacity = String((opacities[index] !== undefined ? opacities[index] : 0.4));
          item.textContent = num;
          historyListEl.appendChild(item);
        });
      }

      function resetGame() {
        remainingNumbers = Array.from({ length: 90 }, (_, i) => i + 1);
        drawnNumbers = [];
        document.querySelectorAll(".classic-cell").forEach((cell) => cell.classList.remove("extracted"));
        currentNumberEl.textContent = "‚Äì";
        statusEl.textContent = "";
        updateStats();
        updateHistory();
        drawBtn.disabled = false;
        drawBtn.textContent = "Estrai";
      }

      function drawNumber() {
        if (remainingNumbers.length === 0) {
          statusEl.textContent = "Tutti i numeri sono gi√† stati estratti.";
          drawBtn.disabled = true;
          return;
        }

        drawBtn.disabled = true;
        statusEl.textContent = "Estrazione in corso...";
        currentNumberEl.textContent = "?";

        setTimeout(() => {
          const randomIndex = Math.floor(Math.random() * remainingNumbers.length);
          const number = remainingNumbers[randomIndex];
          remainingNumbers.splice(randomIndex, 1);
          drawnNumbers.push(number);

          currentNumberEl.textContent = number;
          statusEl.textContent = "Numero estratto!";
          launchConfetti();

          const cell = boardEl.querySelector(`.classic-cell[data-number="${number}"]`);
          if (cell) cell.classList.add("extracted");

          updateStats();
          updateHistory();

          if (remainingNumbers.length === 0) {
            statusEl.textContent = "Tutti i numeri sono stati estratti! üéâ";
            drawBtn.textContent = "Finito";
            drawBtn.disabled = true;
          } else {
            drawBtn.disabled = false;
          }
        }, 700);
      }

      createBoard();
      resetGame();
      drawBtn.addEventListener("click", drawNumber);
      resetBtn.addEventListener("click", resetGame);
    })();

    /* TOMBOLA NATALIZIA --------------------------------------------- */
    (function initXmas() {
      const boardEl = document.getElementById("xmas-board");
      const drawBtn = document.getElementById("xmas-draw-btn");
      const resetBtn = document.getElementById("xmas-reset-btn");
      const spinnerEl = document.getElementById("xmas-spinner");
      const currentNumberEl = document.getElementById("xmas-current-number");
      const statusEl = document.getElementById("xmas-status");
      const drawnCountEl = document.getElementById("xmas-drawn-count");
      const remainingCountEl = document.getElementById("xmas-remaining-count");
      const finishedBannerEl = document.getElementById("xmas-finished-banner");
      const historyListEl = document.getElementById("xmas-history-list");
      const featureCells = document.querySelectorAll(".xmas-feature-cell");

      let remainingNumbers = [];
      let drawnNumbers = [];

      function launchConfetti(sourceEl) {
        try {
          var layer = document.getElementById("confetti-layer");
          if (!layer) return;

          var x0 = window.innerWidth / 2;
          var y0 = window.innerHeight / 2;

          if (sourceEl && sourceEl.getBoundingClientRect) {
            var r = sourceEl.getBoundingClientRect();
            x0 = r.left + r.width / 2;
            y0 = r.top + r.height / 2;
          }

          layer.innerHTML = "";
          var colors = ["#facc15", "#b91c1c", "#15803d", "#fefce8", "#fde68a"];
          var pieces = 42;

          for (var i = 0; i < pieces; i++) {
            var d = document.createElement("div");
            d.className = "confetto";

            var jitterX = (Math.random() - 0.5) * 18;
            var jitterY = (Math.random() - 0.5) * 18;
            d.style.left = (x0 + jitterX) + "px";
            d.style.top  = (y0 + jitterY) + "px";

            var dx = (Math.random() - 0.5) * 220;
            var dy = 120 + Math.random() * 180;
            d.style.setProperty("--dx", dx.toFixed(1) + "px");
            d.style.setProperty("--dy", dy.toFixed(1) + "px");

            var w = 6 + Math.random() * 10;
            var h = 8 + Math.random() * 14;
            d.style.width = w + "px";
            d.style.height = h + "px";

            d.style.background = colors[Math.floor(Math.random() * colors.length)];
            d.style.opacity = String(0.75 + Math.random() * 0.25);
            d.style.animationDelay = (Math.random() * 120) + "ms";

            layer.appendChild(d);
          }

          setTimeout(function () { layer.innerHTML = ""; }, 900);
        } catch (e) {
          console.warn("Confetti error:", e);
        }
      }

      function createBoard() {
        boardEl.innerHTML = "";
        for (let i = 1; i <= 90; i++) {
          const cell = document.createElement("div");
          cell.className = "xmas-cell";
          cell.dataset.number = i;
          cell.textContent = i;
          boardEl.appendChild(cell);
        }
      }

      function updateStats() {
        drawnCountEl.textContent = drawnNumbers.length;
        remainingCountEl.textContent = remainingNumbers.length;
      }

      function updateHistory() {
        historyListEl.innerHTML = "";
        if (drawnNumbers.length === 0) return;

        const lastFive = drawnNumbers.slice(-5).reverse();
        const opacities = [1, 0.85, 0.7, 0.55, 0.4];

        lastFive.forEach((num, index) => {
          const item = document.createElement("div");
          item.className = "xmas-history-item";
          if (index === 0) item.classList.add("newest");
          item.style.opacity = String((opacities[index] !== undefined ? opacities[index] : 0.4));
          item.textContent = num;
          historyListEl.appendChild(item);
        });
      }

      function resetGame() {
        remainingNumbers = Array.from({ length: 90 }, (_, i) => i + 1);
        drawnNumbers = [];
        document.querySelectorAll(".xmas-cell").forEach((cell) => cell.classList.remove("extracted"));
        currentNumberEl.textContent = "‚Äì";
        statusEl.textContent = "";
        updateStats();
        updateHistory();
        drawBtn.disabled = false;
        drawBtn.textContent = "Estrai";
        finishedBannerEl.classList.remove("show");
        featureCells.forEach(cell => cell.classList.remove("used"));
      }

      function showFinishedBanner(){ finishedBannerEl.classList.add("show"); }

      function drawNumber() {
        if (remainingNumbers.length === 0) {
          statusEl.textContent = "Tutti i numeri sono gi√† stati estratti.";
          drawBtn.disabled = true;
          return;
        }

        drawBtn.disabled = true;
        statusEl.textContent = "Estrazione in corso...";
        spinnerEl.classList.add("animate");
        currentNumberEl.textContent = "?";

        setTimeout(() => {
          const randomIndex = Math.floor(Math.random() * remainingNumbers.length);
          const number = remainingNumbers[randomIndex];
          remainingNumbers.splice(randomIndex, 1);
          drawnNumbers.push(number);

          spinnerEl.classList.remove("animate");
          try { try { launchConfetti(currentNumberEl); } catch (e) {} } catch (e) {}
          currentNumberEl.textContent = number;
          statusEl.textContent = "Numero estratto!";

          const cell = boardEl.querySelector(`.xmas-cell[data-number="${number}"]`);
          if (cell) cell.classList.add("extracted");

          updateStats();
          updateHistory();

          if (remainingNumbers.length === 0) {
            statusEl.textContent = "Tutti i numeri sono stati estratti! üéâ";
            drawBtn.textContent = "Finito";
            drawBtn.disabled = true;
            showFinishedBanner();
          } else {
            drawBtn.disabled = false;
          }
        }, 1200);
      }

      createBoard();
      resetGame();
      drawBtn.addEventListener("click", drawNumber);
      resetBtn.addEventListener("click", resetGame);

      /* Gestione popup 9 quadrati */
      const modalEl = document.getElementById("feature-modal");
      const modalContentEl = modalEl.querySelector(".modal-content");
      const modalSlotLabel = document.getElementById("modal-slot-label");
      const modalActivityIcon = document.getElementById("modal-activity-icon");
      const modalActivityTitle = document.getElementById("modal-activity-title");
      const modalActivityText = document.getElementById("modal-activity-text");

      const activities = {
        "1": { icon: "üé§", title: "Mini karaoke",
          description: "Canta per 30‚Äì60 secondi una canzone scelta dall‚Äôanimatore. Chi riesce a continuare pi√π a lungo e con pi√π sicurezza vince." },
        "2": { icon: "üéß", title: "Indovina la canzone",
          description: "Parte un brano: il primo che indovina titolo e cantante vince. L‚Äôanimatore fa partire e fermare la musica." },
        "3": { icon: "üíÉ", title: "Mini balletto",
          description: "Improvvisa una piccola coreografia su un brano casuale. L‚Äôanimatore fa da giudice e decide chi ha fatto il balletto migliore." },
        "4": { icon: "üé¨", title: "Posa famosa",
          description: "Ricrea una posa famosa di una scena di un film oppure di un quadro. L‚Äôanimatore giudice decide la posa pi√π convincente." },
        "5": { icon: "üëÖ", title: "Scioglilingua",
          description: `Prova a dire correttamente uno scioglilingua complesso scelto dall‚Äôanimatore. Se lo dici senza errori, hai vinto la prova.

- Trentatr√© trentini entrarono a Trento, tutti e trentatr√© trotterellando.
- Sopra la panca la capra campa, sotto la panca la capra crepa.
- Se l‚Äôarcivescovo di Costantinopoli si disarcivescoviscostantinopolizzasse, vi disarcivescoviscostantinopolizzereste voi come si disarcivescoviscostantinopolizzerebbe l‚Äôarcivescovo?
- Tre tigri contro tre tigri: tre tigri si azzuffano contro tre tigri.
- Sul tagliere gli aglio non tagliare l‚Äôaglio a taglietti, taglia l‚Äôaglio a tagliatelle!
- Tre stretti struzzi stanno stretti nella stuoia, ma gli astratti struzzi stretti nella stuoia non stanno.
- Settantasette settantenni sedettero sotto un sottoscala scosceso senza sapere se salire o scendere.
- Sciabola sguainata, sguaina la sciabola! Se la sciabola non si sguaina, che sciabola √®?` },
        "6": { icon: "üß†", title: "Memory lampo",
          description: "Osserva 5 oggetti per circa 5 secondi. Poi vengono nascosti: chi ne ricorda di pi√π (nome o posizione) vince." },
        "7": { icon: "ü™®", title: "Caccia al sasso",
          description: "Esci, recupera un sasso da fuori e torna in salone. Chi rientra per primo con il sasso in mano vince la sfida." },
        "8": { icon: "‚ùì", title: "Quiz lampo",
          description: "L‚Äôanimatore fa una domanda di cultura pop, sport, film o attualit√†. Chi risponde correttamente per primo si aggiudica il punto." },
        "9": { icon: "üé≠", title: "Mimo",
          description: `Mima un oggetto, un personaggio o un‚Äôazione senza parlare. Gli altri devono indovinare: chi indovina per primo vince.

- Accendere una candela
- Gonfiare un palloncino
- Aprire un ombrello
- Soffiare le candeline
- Infilare un ago
- Piegare dei vestiti
- Annusare un fiore
- Aprire un regalo
- Saltare di gioia
- Cuoco/Chef
- Pizzaiolo
- Veterinario
- Meccanico
- Pilota d‚Äôaereo
- Postino
- Contadino.
` }
      };

      const slotImageSets = {
        "4": [
          "assets/img/1.png",
          "assets/img/2.png",
          "assets/img/3.png",
          "assets/img/4.png",
          "assets/img/6.png",
          "assets/img/7.png"
        ],
        "6": [
          "assets/img/8.png",
          "assets/img/9.png"
        ]
      };

      let modalSliderState = { images: [], index: 0 };

      function buildModalSlider(slot) {
        const container = document.getElementById("modal-image-container");
        if (!container) return;

        container.innerHTML = "";
        const images = slotImageSets[String(slot)] || [];
        modalSliderState = { images: images.slice(), index: 0 };

        if (modalSliderState.images.length === 0) {
          container.style.display = "none";
          return;
        }
        container.style.display = "block";

        const frame = document.createElement("div");
        frame.className = "modal-slider-frame";

        const img = document.createElement("img");
        img.className = "modal-slider-img";
        img.alt = "Sfida " + slot;
        frame.appendChild(img);

        const controls = document.createElement("div");
        controls.className = "modal-slider-controls";

        const prevBtn = document.createElement("button");
        prevBtn.type = "button";
        prevBtn.className = "modal-slider-btn";
        prevBtn.textContent = "‚Üê";

        const counter = document.createElement("div");
        counter.className = "modal-slider-counter";

        const nextBtn = document.createElement("button");
        nextBtn.type = "button";
        nextBtn.className = "modal-slider-btn";
        nextBtn.textContent = "‚Üí";

        controls.appendChild(prevBtn);
        controls.appendChild(counter);
        controls.appendChild(nextBtn);

        container.appendChild(frame);
        container.appendChild(controls);

        function setSlide(newIndex) {
          const total = modalSliderState.images.length;
          if (total === 0) return;

          modalSliderState.index = (newIndex + total) % total;
          const src = modalSliderState.images[modalSliderState.index];
          img.src = src + "?v=" + Date.now();
          counter.textContent = `immagine ${modalSliderState.index + 1} / ${total}`;

          img.onerror = () => {
            const bad = modalSliderState.images[modalSliderState.index];
            modalSliderState.images = modalSliderState.images.filter(s => s !== bad);
            if (modalSliderState.images.length === 0) {
              container.style.display = "none";
              container.innerHTML = "";
              return;
            }
            setSlide(modalSliderState.index);
          };
        }

        prevBtn.addEventListener("click", () => setSlide(modalSliderState.index - 1));
        nextBtn.addEventListener("click", () => setSlide(modalSliderState.index + 1));

        // tasti freccia quando modal aperta
        function onKey(e){
          if (!modalEl.classList.contains("show")) return;
          if (e.key === "ArrowLeft") setSlide(modalSliderState.index - 1);
          if (e.key === "ArrowRight") setSlide(modalSliderState.index + 1);
        }
        document.addEventListener("keydown", onKey);

        // swipe mobile
        let startX = null;
        frame.addEventListener("touchstart", (e) => { startX = (e.touches && e.touches[0] ? e.touches[0].clientX : null); }, { passive: true });
        frame.addEventListener("touchend", (e) => {
          if (startX === null) return;
          const endX = (e.changedTouches && e.changedTouches[0] ? e.changedTouches[0].clientX : null) || startX;
          const dx = endX - startX;
          if (Math.abs(dx) > 40) {
            if (dx < 0) setSlide(modalSliderState.index + 1);
            else setSlide(modalSliderState.index - 1);
          }
          startX = null;
        });

        setSlide(0);
      }

      function openModal(slot) {
        const activity = activities[slot];
        if (!activity) return;

        modalSlotLabel.textContent = `#${slot}`;
        modalActivityIcon.textContent = activity.icon;
        modalActivityTitle.textContent = activity.title;
        modalActivityText.textContent = activity.description;

        buildModalSlider(slot);

        modalContentEl.style.animation = "none";
        modalContentEl.offsetWidth;
        modalContentEl.style.animation = "modalFlipIn 0.32s ease-out";
        modalEl.classList.add("show");
      }

      function closeModal(){ modalEl.classList.remove("show"); }

      featureCells.forEach(cell => {
        cell.addEventListener("click", () => {
          const slot = cell.getAttribute("data-slot");
          cell.classList.add("used");
          openModal(slot);
        });
      });

      modalEl.addEventListener("click", (e) => {
        if (e.target.dataset.modalClose === "true") closeModal();
      });

      document.addEventListener("keydown", (e) => {
        if (e.key === "Escape") closeModal();
      });
    })();
  </script>
</body>
</html>
